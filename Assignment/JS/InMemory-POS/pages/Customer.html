<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> Customer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <script src="../assets/js/bootstrap.js"></script>

</head>
<body>
<header id="headerSection">
    <nav class="navbar navbar-expand-lg" style="background: #d60f0f;">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold text-dark" href="#">
                <img src="../assets/img/cart%20logo.png" alt="Bootstrap" width="40" height="40"> POS System
            </a>
            <div class="collapse navbar-collapse ms-4" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link text-white" href="../index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="Customer.html">Customer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="Item.html">Store</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="PlaceOrder.html">Order</a>
                    </li>
                </ul>
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-light" type="Button">Search</button>
                </form>
            </div>
        </div>
    </nav>
</header>


<!-------Tab header and search bar---------->

<main class="justify-content-center mt-4 align-content-center">
    <section class="row col-12">
        <section id="displaySection" class="col-9 mx-0 my-4">
            <section id="formNameAndSearch" class="mx-4">
                <nav class="navbar bg-light  ">
                    <div class="container-fluid">
                        <a class="navbar-brand">Manage Customer</a>
                        <form class="d-flex" role="search">

                            <!-- Example single danger button -->
                            <div class="btn-group mx-2">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="background: #d60f0f;">
                                    ID
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">ID</a></li>
                                    <li><a class="dropdown-item" href="#">Name</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#">Separated link</a></li>
                                </ul>
                            </div>

                            <!--<button type="button" class="btn btn-success">Add New +</button>-->

                        </form>
                    </div>
                </nav>
            </section>

            <section id="table" class="mx-4">
                <table class="table my-4">
                    <thead class="table-dark">
                    <tr id="tableHeader">
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Address</th>
                        <th scope="col">Salary</th>
                    </tr>
                    </thead>
                    <tbody id="tblCustomer">
                    </tbody>
                </table>
            </section>
        </section>

        <section id="inputSection" class="col-3 justify-content-center my-4 " >
            <section class="col-12 card">
                <div class="badge bg-warning text-wrap fs-5 fw-semibold p-4"  >
                    Input Details
                </div>

                <form id="item-form px-2" >
                    <div class="m-3">
                        <label for="txtCustID" class="form-label">Customer ID</label>
                        <input type="text" class="form-control " placeholder="C001" id="txtCustID">
                    </div>
                    <div class="m-3">
                        <label for="txtCustName" class="form-label">Customer Name</label>
                        <input type="text" class="form-control" placeholder="Nethmi" id="txtCustName" >
                    </div>
                    <div class="m-3">
                        <label for="txtCustAddress" class="form-label">Customer address</label>
                        <input type="text" class="form-control" placeholder="Galle" id="txtCustAddress" >
                    </div>
                    <div class="m-3">
                        <label for="txtCustSalary" class="form-label">Customer Salary</label>
                        <input type="text" class="form-control" placeholder="35000.00" id="txtCustSalary" >
                    </div>

                    <div class="m-3 justify-content-center">
                        <div style="display: inline-block" class="me-2">
                            <button id="save-btn" type="button" class="btn btn-success">Save</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="updated-btn" type="button" class="btn btn-primary">Update</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="delete-btn" type="button" class="btn btn-danger">Delete</button>
                        </div>
                        <div style="display: inline-block" class="me-2">
                            <button id="clear-btn" type="button" class="btn btn-warning">Clear</button>
                        </div>
                        <div style="display: inline-block">
                            <button id="getAll-btn" type="button" class="btn btn-secondary">Get All</button>
                        </div>
                    </div>

                </form>
            </section>
        </section>
    </section>
</main>
<script src="../assets/js/jquery-3.7.0.min.js"></script>
<script>
    var customerArray =[];
    //customer save button event
    $("#save-btn").click(function (){
        saveCustomer();

        loadAllCustomer();

        bindRowClickEventsCustomer();

        clearCustomer();

        loadAllCustomerOption();

        alert("Customer Successfully Saved!")

    });

    //customer save function
    function saveCustomer(){
        let customerID = $("#txtCustID").val();
        let customerName = $("#txtCustName").val();
        let customerAddress = $("#txtCustAddress").val();
        let customerSalary = $("#txtCustSalary").val();

        var customerObj = {
            id: customerID,
            name: customerName,
            address: customerAddress,
            salary: customerSalary
        }

        customerArray.push(customerObj);
        /*bindRowClickEvents();
        loadAllCustomer();*/
        console.log(customerObj);
    }

    //customer clear function
    function clearCustomer(){
        $('#txtCustID').val('');
        $('#txtCustName').val('');
        $('#txtCustAddress').val('');
        $('#txtCustSalary').val('');
        console.log("clean");

    }

    $("#clear-btn").click(function (){
        clearCustomer();
    });

    //customer get all button event
    $("#getAll-btn").click(function (){
        loadAllCustomer();
        clearCustomer();
    });

    //customer load all button event
    function loadAllCustomer(){

        //remove all the table body content before adding data
        $("#tblCustomer").empty();

        for (var customer of customerArray){

            // Using String Literals to do the same thing as above
            var row = `<tr><td>${customer.id}</td><td>${customer.name}</td><td>${customer.address}</td><td>${customer.salary}</td></tr>`;

            //then add it to the table body of customer table
            $("#tblCustomer").append(row);
            console.log("printed");
        }
    }

    //customer table row click event and load to text field
    function bindRowClickEventsCustomer() {
        $("#tblCustomer>tr").click(function () {
            let id = $(this).children(":eq(0)").text();
            let name = $(this).children(":eq(1)").text();
            let address = $(this).children(":eq(2)").text();
            let salary = $(this).children(":eq(3)").text();
            console.log(id, name, address, salary);

            //setting table details values to text fields
            $('#txtCustID').val(id);
            $('#txtCustName').val(name);
            $('#txtCustAddress').val(address);
            $('#txtCustSalary').val(salary);
        });
    }


    //customer search button event
    $('#customerSearch-btn').click(function(){
        let typedId = $("#customerSearchTxt").val();
        let customer = searchCustomer(typedId);
        if (customer != null) {
            $('#txtCustId').val(customer.id);
            $('#txtCustName').val(customer.name);
            $('#txtCustAddress').val(customer.address);
            $('#txtCustSalary').val(customer.salary);
        } else {
            Swal.fire("Not Available Customer for " + typedId)
            setTextfieldValues("", "", "", "");
        }
    })

    //customer search function
    function searchCustomer(custID) {
        for (let customer of customerArray) {
            if (customer.id== custID) {
                return customer;
                console.log(customer)
            }
        }
        return null;
    }

    //customer delete button event
    $('#delete-btn').click(function (){
        let cusId=$("#txtCustID").val();
        console.log(cusId);
        let option=confirm('Do you want to delete this customer'+cusId)
        if(option){
            if(deleteCustomer(cusId)){
                Swal.fire({
                    icon: 'delete',
                    title: 'Deleted...',
                    text: 'Customer Successfully Deleted!',
                })
                $('#txtCustId').val('')
                $('#txtcustName').val('')
                $('#txtcustAddress').val('')
                $('#txtcustSalary').val('')
            }
            else{
                Swal.fire("No such customer to delete. please check the id" )
            }
        }
    })

    //customer delete function
    function deleteCustomer(customerID){
        let customer= searchCustomer(customerID)
        if(customer!=null){
            let indexNo= customerArray.indexOf(customer);
            customerArray.splice(indexNo,1);
            loadAllCustomer();
            return true;
        }else{
            return false;
        }
    }

    //customer update button event
    $('#updated-btn').click(function(){
        let customerId=$('#txtCustID').val()
        let response=updateCustomer(customerId)
        if(response){
            Swal.fire({
                position: 'center',
                icon: 'success',
                title: 'Customer Updated Successfully',
                showConfirmButton: false,
                timer: 1500
            });
            /*$('#txtCustId').val('')
            $('#txtCustName').val('')
            $('#txtCustAddress').val('')
            $('#txtCustSalary').val('')*/

            clear();
        }
        else{
            Swal.fire("Update Failed..!" );
        }
    })

    //customer update function
    function updateCustomer(customerID){
        let customer= searchCustomer(customerID)
        if(customer !=null){
            customer.id=$('#txtCustID').val()
            customer.name= $('#txtCustName').val()
            customer.address= $('#txtCustAddress').val()
            customer.salary= $('#txtCustSalary').val()
            loadAllCustomer();
            return true
        }
        else{
            return false
        }
    }

    //enter key focus event and validations
    $('#txtCustID').focus();
    $('#txtCustID').on('keydown',function(event){
        if(event.key=='Enter'){
            var id = /^(C)[0-9]{3}$/;
            var result = id.test($("#txtCustID").val());
            if (result) {
                $("#txtCustID").css({
                    'border': '2px solid green'
                })
                $('#txtCustName').focus();
            } else {
                $("#txtCustID").css({
                    'border-color': 'red'
                })

                $('#txtCustID').error='Customer ID Pattern is Wrong : C00-001'
            }
        }
    })
    $('#txtCustName').on('keydown',function(event){
        if(event.key=='Enter'){
            var Name = /^[A-z ]{3,15}$/;
            var result = Name.test($("#txtCustName").val());
            console.log(result);

            if (result) {
                $("#txtCustName").css({
                    'border-color': 'green'
                })
                $('#txtCustAddress').focus();
            } else {
                $("#txtCustName").css({
                    'border-color': 'red'
                })
            }
        }
    })
    $('#txtCustAddress').on('keydown',function(event){
        if(event.key=='Enter'){
            var address=/^[A-z0-9 ,/]{4,20}$/
            var result=address.test($('#txtCustAddress').val())
            if(result){
                $('#txtCustAddress').css({
                    'border-color': 'green'
                })
                $('#txtCustSalary').focus();
            }
            else{
                $('#txtCustAddress').css({
                    'border-color': 'red'
                })
            }
        }
    })
    $('#txtCustSalary').on('keydown',function(event){
        if(event.key=='Enter'){
            var salary=/^[1-9][0-9]*(.[0-9]{2})?$/;
            var result=salary.test($("#txtCustSalary").val())
            if (result){
                $('#txtCustSalary').css({
                    'border-color': 'green'
                })
                confirm('Do you want to save this customer')
                saveCustomer();
                loadAllCustomers();
                clear();
            }
            else{
                $('#txtCustSalary').css({
                    'border-color': 'red'
                })
            }
        }
    })

    ////disable tab key of all  text fields
    $('#txtCustId,#txtCustName,#txtCustAddress,#txtCustSalary').on('keydown',function(event){
        if(event.key=='Tab'){
            event.preventDefault();
        }
    })

</script>

</body>
</html>